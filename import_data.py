'''import_data.py'''
import csv
import sqlite3
import os

# Get the path to the instance folder
instance_path = os.path.join(os.path.dirname(__file__), 'instance')

# Connect to SQLite database
db_path = os.path.join(instance_path, 'cve_database.db')
conn = sqlite3.connect(db_path)
cursor = conn.cursor()

# Create table to store CVE data
cursor.execute('''CREATE TABLE IF NOT EXISTS cve (
                    cve_id TEXT PRIMARY KEY,
                    severity TEXT,
                    cvss REAL,
                    affected_packages TEXT,
                    description TEXT,
                    cwe_id TEXT
                )''')

# Read data from CSV and insert into database
csv_path = 'cve_data.csv'
with open(csv_path, newline='') as csvfile:
    reader = csv.DictReader(csvfile)
    for row in reader:
        cursor.execute('''INSERT INTO cve (cve_id, severity, cvss, affected_packages, description, cwe_id)
                          VALUES (?, ?, ?, ?, ?, ?)''',
                          (row['CVE-ID'], row['Severity'], row['CVSS'], row['Affected Packages'], row['Description'], row['CWE-ID']))

# Commit changes and close connection
conn.commit()
conn.close()
